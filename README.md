# XLS Consolidator v20260129

**發布日期**: 2026-01-29
**版本狀態**: ✅ 正式版 (Production Release)

---

## ⚖️ 授權聲明

### 🔒 版權與使用限制

```
本軟體為私有產品，不授權他人使用、複製、修改或分發。

© 2025-2026 版權所有，保留所有權利。
未經書面許可，禁止任何形式的使用、分享或衍生。
```

**明確規定**:
- ❌ 不可轉讓給第三方
- ❌ 不可在其他項目中使用
- ❌ 不可分享或發布原始碼
- ❌ 不可進行反向工程
- ❌ 不可商業使用
- ✅ 僅限授權使用者在授權範圍內使用

---

## 🎯 產品簡介

XLS Consolidator 是一個專業的 BOM (Bill of Materials) 層級處理系統，專為處理從 **SAP ZSDR392** 下載的 XLS 檔案而設計，支援自動化合併處理與新增欄位，並支援多種輸入方式和中文編碼。

### 核心特性

✅ **多種輸入方式**
- 單檔案選擇
- 資料夾自動掃描（含子目錄）
- ZIP / 7z 壓縮包自動提取

✅ **中文編碼完美支援**
- Big5 編碼（台灣/香港格式）
- UTF-8 編碼
- GBK 編碼
- GB18030 編碼

✅ **即時處理反饋**
- 即時進度顯示
- 目前檔案名稱
- 處理速度統計

✅ **國際化支援**
- 繁體中文
- English

✅ **BOM 層級智能處理**
- 43/45 料號優先級處理
- 嚴格向上查找限制
- LN 自動重新編號
- Material 層級索引與快速查詢

---

## 📦 檔案清單

```
XLS_Consolidator/
├── index.html                 # 主應用程式（雙擊打開）
├── bom_processor.js           # BOM 處理引擎 (v2.10.0)
├── archive-handler.js         # 壓縮檔處理器 (ZIP/7z)
├── i18n.js                    # 國際化語言包
├── Logo.svg                   # 應用程式圖示
├── README.md                  # 本檔案（產品說明）
├── css/
│   └── style.css              # 樣式檔案
└── lib/
    ├── xlsx.full.min.js        # Excel 讀寫函式庫
    ├── FileSaver.min.js        # 檔案下載函式庫
    ├── papaparse.min.js        # CSV 解析函式庫
    ├── jszip.min.js            # ZIP 壓縮函式庫
    └── libarchive/             # 7z 壓縮支援函式庫
```

---

## 🚀 快速開始

### 方式 1：本地使用（推薦新手）

```
1. 下載所有檔案到本地資料夾
2. 雙擊打開 index.html
3. 選擇輸入方式：[📄 檔案] [📁 資料夾] [📦 壓縮檔(.zip/.7z)]
4. 選擇您的 XLS 檔案或資料夾
5. 點擊 [⚙️ 開始處理]
6. 自動下載處理結果
```

### 方式 2：伺服器部署

```
1. 將所有檔案上傳到 web 伺服器
2. 通過瀏覽器訪問 index.html
3. 功能完全相同，支援多使用者並發
```

### 方式 3：離線打包

```
1. 將檔案整合到內部系統
2. 支援完全離線執行
3. 無需網路連接
```

---

## 💡 使用場景

### 場景 1：處理單個 XLS 檔案

```
➜ 選擇 [📄 檔案]
➜ 選擇 BOM_20260129.xls
➜ 點擊 [開始處理]
➜ 下載 20260129_xxxxx_consolidated_data.xlsx
```

### 場景 2：批量處理資料夾

```
➜ 選擇 [📁 資料夾]
➜ 選擇包含 XLS 檔案的資料夾
➜ 系統自動掃描所有子資料夾
➜ 一次性處理所有 XLS 檔案
```

### 場景 3：處理壓縮包（ZIP / 7z）

```
➜ 選擇 [📦 壓縮檔(.zip/.7z)]
➜ 選擇包含 XLS 的 ZIP 或 7z 檔案
➜ 系統自動提取並處理
➜ 自動生成統一結果
```

---

## 🔧 技術規格

### 系統要求

**瀏覽器**
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

**作業系統**
- Windows 10+
- macOS 10.15+
- Linux（主流發行版）

**檔案格式**
- ✅ XLS（優先支援）
- ❌ XLSX（不支援，防止混淆）
- ✅ ZIP（完全支援）
- ✅ 7z（完全支援）

### 性能指標

| 指標 | 數值 |
|------|------|
| 小檔案處理速度 | <100ms |
| 中等檔案處理速度 | 100-500ms |
| 大檔案處理速度 | 500ms-2s |
| 最大並發檔案數 | 100+ |
| 最大壓縮包大小 | 500MB |
| 記憶體占用（基礎） | 20-30MB |
| 記憶體占用（峰值） | 50-100MB |

---

## 📊 功能對比

| 功能 | v1.0 | v1.1 | v2.x |
|------|------|------|------|
| 中文編碼支援 | ✅ | ✅ | ✅ |
| 資料夾掃描 | ✅ | ✅ | ✅ |
| ZIP 提取 | ✅ | ✅ | ✅ |
| 7z 提取 | ❌ | ❌ | ✅ |
| 即時進度 | ✅ | ✅ | ✅ |
| 統計資訊 | ✅ | ✅ | ✅ |
| 多語言 | ✅ | ✅ | ✅ |
| 離線執行 | ✅ | ✅ | ✅ |
| 行動適配 | ✅ | ✅ | ✅ |
| 43/45 料號優先處理 | ❌ | ❌ | ✅ |
| LN 自動重新編號 | ❌ | ❌ | ✅ |
| 嚴格向上查找 | ❌ | ❌ | ✅ |

---

## 🛠️ 編碼支援

### 優先級順序

```
優先級 1: Big5 (台灣/香港 XLS 檔案)
優先級 2: UTF-8 (標準編碼)
優先級 3: GBK (中國大陸編碼)
優先級 4: GB18030 (備用編碼)
```

**自動偵測流程**
1. 嘗試 Big5 解碼
2. 失敗則嘗試 UTF-8
3. 失敗則嘗試 GBK
4. 最後嘗試 GB18030
5. 仍失敗則報錯

---

## 📈 資料流程

```
輸入選擇
    ↓
┌─────────────────────────────────┐
│ 單檔案 / 資料夾 / ZIP / 7z      │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 統一檔案列表處理                 │
│ (processFileList)               │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 逐檔案處理                       │
│ (processFile + 編碼偵測)         │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ BOM 層級處理                     │
│ (BOMHierarchyProcessor v2.10.0) │
│ - 43/45 料號優先處理             │
│ - 嚴格向上查找限制               │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 即時進度更新                     │
│ 顯示: 檔案名 + 進度              │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 資料合併 + 統計                  │
└─────────────────────────────────┘
    ↓
自動下載結果 (XLSX 格式)
```

---

## 🎨 使用者介面

### 主介面佈局

```
┌─────────────────────────────────────────────┐
│  [Logo] XLS合併工具              [中] [EN]  │
│  從SAP ZSDR392下載的XLS檔案                 │
│  進行自動化合併處理&新增欄位                │
└─────────────────────────────────────────────┘
┌─────────────────────────────────────────────┐
│ 📥 輸入數據                                 │
│                                             │
│ 選擇輸入類型                                 │
│ [📄 檔案] [📁 資料夾] [📦 壓縮檔(.zip/.7z)] │
│                                             │
│ [⚙️ 開始處理]                               │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 123 個檔案                           │   │
│ │ 資料夾: FolderName/SubFolder         │   │
│ └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

### 處理狀態

```
正在處理資料中... (3/10): BOM_20260129.xls

📊 處理結果統計
├─ 檔案數量: 10
├─ 總行數: 1,234
├─ 處理耗時: 2,345ms
├─ 平均檔案耗時: 234ms
└─ 吞吐量: 526 行/秒
```

---

## 🔐 隱私與安全

✅ **完全本地處理** - 資料不上傳到伺服器
✅ **無追蹤** - 不收集使用者資訊
✅ **開放邏輯** - 代碼可讀且可驗證
✅ **安全編碼** - 輸入驗證和錯誤處理

---

## 📋 常見問題

**Q: 為什麼只支援 XLS，不支援 XLSX？**
A: XLS 是穩定的舊格式，XLSX 易引起混淆。系統優先支援 XLS 以確保相容性。

**Q: 中文出現亂碼怎麼辦？**
A: 系統會自動嘗試多種編碼。如仍有問題，請檢查檔案編碼設定。

**Q: 支援多少個檔案？**
A: 理論上支援 100+ 個檔案，實際取決於瀏覽器記憶體。

**Q: 能否在行動設備上使用？**
A: 支援，但推薦在桌面瀏覽器上使用以獲得最佳體驗。

**Q: 處理資料是否安全？**
A: 完全安全。所有處理都在本地進行，資料不經過伺服器。

**Q: 為什麼路徑顯示不包含磁碟機代號（C:/ 或 D:/）？**
A: 基於瀏覽器安全限制，網頁應用程式無法取得檔案的完整磁碟路徑。系統會顯示相對路徑，並使用前導文字（檔案:、資料夾:、壓縮檔:）標示類型。

**Q: 7z 壓縮包支援哪些版本？**
A: 透過 libarchive.js 函式庫，支援標準 7z 壓縮格式。

---

## 📞 獲取幫助

### 遇到問題？

1. **檢查瀏覽器控制台** → F12 鍵
2. **查看錯誤訊息** → 根據提示排查
3. **確認檔案格式** → 確保為有效的 XLS 檔案
4. **嘗試其他瀏覽器** → 排除瀏覽器相容性問題

### 聯絡方式

- 📧 如有技術支援需求，請聯絡授權管理員
- 🆘 發現漏洞或問題，請立即報告

---

## 📝 版本資訊

**目前版本**: v20260129
**BOM 引擎版本**: v2.10.0
**發布日期**: 2026-01-29
**產品狀態**: ✅ Production Ready

---

## 📦 更新日誌

### v20260129 (2026-01-29) - 7z 支援與 UI 精簡

**新功能**
✅ 新增 7z 壓縮檔支援（透過 libarchive.js）
✅ 壓縮檔按鈕更名為「壓縮檔(.zip/.7z)」，清楚標示支援格式

**UI 優化**
✅ 移除檔案選擇後的訊息提示框，介面更簡潔
✅ 標題置中，手機版語言切換保持右上角
✅ 按鈕狀態優化、頁面寬度調整

**技術改進**
✅ 新增 archive-handler.js，使用 libarchive.js 統一處理 ZIP 和 7z
✅ 修復檔案選取視窗延遲開啟問題

---

### v20260116 (2026-01-16) - BOM 引擎 v2.10.0

**BOM 處理引擎**
✅ 新增 43/45 料號優先級處理邏輯
  - 找到 43 料號時，繼續向上查找是否有 45 料號
  - 若找到 45，返回 45；否則返回 43
✅ 修復 Material 查找邏輯：改為嚴格向上查找，禁止向下查找
✅ 新增輔助方法 `_is43Pattern()` 和 `_is45Pattern()`
✅ `_buildMaterialIndex` 改為存儲所有索引（陣列）
✅ 新增 `_findMaterialBeforeLN` 方法，限制只查找 LN < currentLN 的行

---

### v1.1 (2026-01-08) - UI/UX 優化與規則擴展

**UI/UX 改進**
✅ 檔案個數顯示改為單語言（隨介面語言動態切換）
✅ 路徑顯示改為兩行格式（檔案個數與路徑分離顯示）
✅ 路徑顯示加入類型前導文字
  - 中文：檔案: / 資料夾: / 壓縮檔:
  - 英文：File: / Folder: / ZIP:
✅ 語言切換時自動更新路徑顯示

**功能增強**
✅ 更新 SPECIAL_LV_RULES 設定
  - 合併多個前綴規則為單一規則
  - 新增支援前綴：HG、EC、FH、AM、MA、AP、FA
  - 配置：`{lv: 2, prefix: 'DCS|DC02|HG|EC|FH|AM|MA|AP|FA'}`

**技術改進**
✅ 優化路徑顯示邏輯，支援相對路徑顯示
✅ 改進 CSS 樣式，第一行使用加粗和綠色突出顯示

---

### v1.0 (2025-12-19) - 首次正式發布

✅ 中文編碼完美支援
✅ 資料夾/ZIP 處理穩定
✅ 即時進度追蹤
✅ 多語言介面
✅ 行動適配
✅ 完整文件
✅ 生產級品質

---

## 🎉 開始使用

**準備好了嗎？**

👉 **雙擊打開 index.html 即刻開始！**

祝您使用愉快！

---

## 📄 授權條款

### 明確聲明

本軟體為私有智慧財產權，不授權任何第三方使用、複製或分發。

**禁止事項**:
- ❌ 未經授權複製或分發本軟體
- ❌ 進行反向工程或原始碼提取
- ❌ 修改、改編或衍生作品
- ❌ 商業使用或租賃
- ❌ 轉讓給其他個人或組織
- ❌ 公開發布或上傳到公共平台

**違反後果**:
⚠️ 未經授權使用本軟體將承擔法律責任

---

**支援**: 聯絡授權管理員獲取幫助
**反饋**: 僅授權使用者可提供改進建議
**更新**: 持續優化和維護中
